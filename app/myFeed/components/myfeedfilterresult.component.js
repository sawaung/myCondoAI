"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var router_2 = require("nativescript-angular/router");
var myfeed_model_1 = require("../model/myfeed.model");
var myfeed_service_1 = require("../services/myfeed.service");
require("nativescript-localstorage");
var globalstorage_service_1 = require("../../shared/store/globalstorage.service");
var observable_array_1 = require("tns-core-modules/data/observable-array");
var Timer = require("tns-core-modules/timer");
var LoadingIndicator = require("nativescript-loading-indicator").LoadingIndicator;
var data_service_1 = require("../../shared/services/data.service");
var MyFeedFilterResultComponent = /** @class */ (function () {
    function MyFeedFilterResultComponent(router, route, dataService, routerExtensions, feedService, globalStorageService) {
        var _this = this;
        this.router = router;
        this.route = route;
        this.dataService = dataService;
        this.routerExtensions = routerExtensions;
        this.feedService = feedService;
        this.globalStorageService = globalStorageService;
        this.isLoading = false;
        this.feedFilterInfo = new myfeed_model_1.FeedFilter();
        this.para = new myfeed_model_1.FeedFilter();
        this.newsFeedList = new observable_array_1.ObservableArray();
        MyFeedFilterResultComponent_1.myFeedFilterResultComponent = this;
        this.route.queryParams.subscribe(function (params) {
            _this.para = JSON.parse(params["FeedFilterInfo"]);
            console.log("Feed_Id " + _this.para.SearchKeyword);
        });
    }
    MyFeedFilterResultComponent_1 = MyFeedFilterResultComponent;
    MyFeedFilterResultComponent.prototype.ngOnInit = function () {
        this.initialize();
        this.loadFeedList();
    };
    MyFeedFilterResultComponent.prototype.ngAfterViewInit = function () {
        this.radListView = this.radListViewRef.nativeElement;
    };
    MyFeedFilterResultComponent.prototype.onNavBtnTap = function () {
        this.routerExtensions.backToPreviousPage();
    };
    MyFeedFilterResultComponent.prototype.initialize = function () {
        if (this.para.Feed_Category_Id == "") {
            this.feedFilterInfo.Feed_Category_Id = null;
        }
        else {
            this.feedFilterInfo.Feed_Category_Id = this.para.Feed_Category_Id;
        }
        if (this.para.FeedType_Id == "") {
            this.feedFilterInfo.FeedType_Id = null;
        }
        else {
            this.feedFilterInfo.FeedType_Id = this.para.FeedType_Id;
        }
        this.feedFilterInfo.Title = null;
        this.feedFilterInfo.SearchKeyword = this.para.SearchKeyword;
        this.feedFilterInfo.Posted_Date_From = this.para.Posted_Date_From;
        this.feedFilterInfo.Posted_Date_To = this.para.Posted_Date_To;
        this.feedFilterInfo.Created_From = this.para.Created_From;
        this.feedFilterInfo.Created_To = this.para.Created_To;
        this.feedFilterInfo.Cursor_Index = null;
        this.feedFilterInfo.Get_Next = false;
        this.feedFilterInfo.Page_Size = 10;
        this.feedFilterInfo.Post_Status = this.para.Post_Status;
        this.feedFilterInfo.UnPost_Status = this.para.UnPost_Status;
        this.feedFilterInfo.isBlocked = this.para.isBlocked;
    };
    MyFeedFilterResultComponent.prototype.loadFeedList = function () {
        var _this = this;
        this.busy = this.feedService.getNewsfeedlist(this.feedFilterInfo.Feed_Category_Id, this.feedFilterInfo.FeedType_Id, this.feedFilterInfo.Title, this.feedFilterInfo.SearchKeyword, this.feedFilterInfo.Posted_Date_From, this.feedFilterInfo.Posted_Date_To, this.feedFilterInfo.Created_From, this.feedFilterInfo.Created_To, this.feedFilterInfo.Cursor_Index, this.feedFilterInfo.Get_Next, this.feedFilterInfo.Page_Size, this.feedFilterInfo.Post_Status, this.feedFilterInfo.UnPost_Status, this.feedFilterInfo.isBlocked)
            .subscribe(function (res) {
            _this.isLoading = false;
            var feedList = Array();
            res.result.forEach(function (feed) {
                feedList.push(feed);
            });
            _this.newsFeedList.push(feedList);
            console.log("loadFeedList --> " + JSON.stringify(res));
        });
    };
    MyFeedFilterResultComponent.prototype.onLoadMoreItemsRequested = function (args) {
        var that = new WeakRef(this);
        var listView = args.object;
        var arrLength = that.get().newsFeedList.length;
        Timer.setTimeout(function () {
            that.get().loadMoreFeeds();
            listView.notifyLoadOnDemandFinished();
        }, 1000);
        //}
        args.returnValue = true;
    };
    MyFeedFilterResultComponent.prototype.onItemTap = function (args) {
        var selectedIndex = args.index;
        var feed = this.newsFeedList.getItem(selectedIndex);
        var navigationExtras = {
            queryParams: {
                "CallerClass": "MyFeedFilterResultComponent",
                "SelectedPosition": selectedIndex,
            }
        };
        this.router.navigate(["/myfeed/" + feed.Feed_Id + "/view"], navigationExtras); //route to feed_detail(1)
    };
    MyFeedFilterResultComponent.prototype.loadMoreFeeds = function () {
        if (this.newsFeedList.length > 0) {
            this.feedFilterInfo.Cursor_Index = this.newsFeedList.getItem(this.newsFeedList.length - 1).Feed_Id;
            this.feedFilterInfo.Get_Next = false;
        }
        this.loadFeedList();
    };
    MyFeedFilterResultComponent.prototype.getInnerHtml = function (desc) {
        var dot = '';
        var rtn = desc.replace(/<\/?[^>]+>/ig, " ");
        rtn = rtn.replace("\n", "");
        rtn = rtn.replace("&nbsp;", "");
        if (rtn.length > 100) {
            dot = '.....';
        }
        rtn = rtn.substring(0, 100);
        if (rtn.length > 0) {
            return rtn + dot;
        }
        else {
            return '';
        }
    };
    MyFeedFilterResultComponent.prototype.updateMyFeedsUI = function (feed, isFeedUpdateOrCreate, position) {
        var _this = this;
        console.log("feed " + JSON.stringify(feed));
        console.log("update my feedList " + isFeedUpdateOrCreate + " position " + position);
        if (isFeedUpdateOrCreate == "new") {
            this.newsFeedList.unshift(feed);
            this.radListView.refresh();
            //alert("Feed successfully created!");
        }
        else if (isFeedUpdateOrCreate == "update") {
            //this.newsFeedList.splice(position, 1);// 1, 1
            //this.newsFeedList.splice(position,0,feed);//1,feed
            //this.newsFeedList.notify;
            this.newsFeedList.getItem(position).Feed_Category_Id = feed.Feed_Category_Id;
            this.newsFeedList.getItem(position).Feed_Category_Name = feed.Feed_Category_Name;
            this.newsFeedList.getItem(position).FeedType_Id = feed.FeedType_Id;
            this.newsFeedList.getItem(position).Feed_Type_Name = feed.Feed_Type_Name;
            this.newsFeedList.getItem(position).Title = feed.Title;
            this.newsFeedList.getItem(position).Description = feed.Description;
            this.newsFeedList.getItem(position).Posted_Date = feed.Posted_Date;
            this.newsFeedList.getItem(position).Post_Status = feed.Post_Status;
            this.newsFeedList.getItem(position).Last_Updated_By = feed.Last_Updated_By;
            this.newsFeedList.getItem(position).Last_Updated_On = feed.Last_Updated_On;
            this.newsFeedList.getItem(position).status = feed.status;
            this.newsFeedList.getItem(position).MC_Feed_Files = feed.MC_Feed_Files;
            //alert("Feed successfully updated!");
        }
        else if (isFeedUpdateOrCreate == "ARCHIVE") {
            try {
                console.log("unpost myFeeds");
                setTimeout(function () {
                    var i = _this.newsFeedList.indexOf(_this.newsFeedList.getItem(position));
                    _this.newsFeedList.splice(i, 1);
                    //alert("Feed successfully unposted!");                     
                    console.log("remove " + position);
                }, 2000);
            }
            catch (e) {
                console.log(e);
            }
        }
        else if (isFeedUpdateOrCreate == "NOTIFY") {
            alert("Feeds successfully notified!");
        }
    };
    MyFeedFilterResultComponent.getMyFeedsFilterResultObject = function () {
        return MyFeedFilterResultComponent_1.myFeedFilterResultComponent;
    };
    __decorate([
        core_1.ViewChild("radListView"),
        __metadata("design:type", core_1.ElementRef)
    ], MyFeedFilterResultComponent.prototype, "radListViewRef", void 0);
    MyFeedFilterResultComponent = MyFeedFilterResultComponent_1 = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'app-myfeedfilterresult',
            templateUrl: 'myfeedfilterresult.html',
        }),
        __metadata("design:paramtypes", [router_1.Router, router_1.ActivatedRoute, data_service_1.DataService, router_2.RouterExtensions, myfeed_service_1.MyFeedService, globalstorage_service_1.GlobalStorageService])
    ], MyFeedFilterResultComponent);
    return MyFeedFilterResultComponent;
    var MyFeedFilterResultComponent_1;
}());
exports.MyFeedFilterResultComponent = MyFeedFilterResultComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXlmZWVkZmlsdGVycmVzdWx0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm15ZmVlZGZpbHRlcnJlc3VsdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBd0U7QUFDeEUsMENBQXlFO0FBQ3pFLHNEQUE2RDtBQUU3RCxzREFBa0c7QUFDbEcsNkRBQTJEO0FBVTNELE9BQU8sQ0FBRSwyQkFBMkIsQ0FBRSxDQUFDO0FBQ3ZDLGtGQUErRTtBQUMvRSwyRUFBeUU7QUFLekUsOENBQWdEO0FBQ2hELElBQUksZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLGdDQUFnQyxDQUFDLENBQUMsZ0JBQWdCLENBQUM7QUFDbEYsbUVBQWlFO0FBWWpFO0lBZ0JJLHFDQUFvQixNQUFjLEVBQVMsS0FBcUIsRUFBUyxXQUF1QixFQUFTLGdCQUFrQyxFQUFTLFdBQXlCLEVBQVUsb0JBQXlDO1FBQWhPLGlCQVdDO1FBWG1CLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBUyxVQUFLLEdBQUwsS0FBSyxDQUFnQjtRQUFTLGdCQUFXLEdBQVgsV0FBVyxDQUFZO1FBQVMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUFTLGdCQUFXLEdBQVgsV0FBVyxDQUFjO1FBQVUseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFxQjtRQWJoTyxjQUFTLEdBQVksS0FBSyxDQUFDO1FBSTNCLG1CQUFjLEdBQWUsSUFBSSx5QkFBVSxFQUFFLENBQUM7UUFDOUMsU0FBSSxHQUFjLElBQUkseUJBQVUsRUFBRSxDQUFDO1FBUy9CLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSyxrQ0FBZSxFQUFtQixDQUFDO1FBQzVELDZCQUEyQixDQUFDLDJCQUEyQixHQUFHLElBQUksQ0FBQztRQUUvRCxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsVUFBQSxNQUFNO1lBRW5DLEtBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FB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QUFDLGFBQWEsQ0FBQztrQ0FBaUIsaUJBQVU7dUVBQUM7SUFmNUMsMkJBQTJCO1FBUnZDLGdCQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7WUFDbkIsUUFBUSxFQUFFLHdCQUF3QjtZQUNsQyxXQUFXLEVBQUUseUJBQXlCO1NBRXpDLENBQUM7eUNBbUI4QixlQUFNLEVBQWdCLHVCQUFjLEVBQXFCLDBCQUFXLEVBQTJCLHlCQUFnQixFQUFxQiw4QkFBYSxFQUErQiw0Q0FBb0I7T0FoQnZOLDJCQUEyQixDQTBNdkM7SUFBRCxrQ0FBQzs7Q0FBQSxBQTFNRCxJQTBNQztBQTFNWSxrRUFBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFZpZXdDaGlsZCwgT25Jbml0LEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlciwgQWN0aXZhdGVkUm91dGUsTmF2aWdhdGlvbkV4dHJhc30gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7Um91dGVyRXh0ZW5zaW9uc30gZnJvbSBcIm5hdGl2ZXNjcmlwdC1hbmd1bGFyL3JvdXRlclwiO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBGZWVkSW5mb3JtYXRpb24sIEZlZWRUeXBlLCBGZWVkQ2F0ZWdvcnksIEZlZWRGaWx0ZXIsIFJvbGUgfSBmcm9tICcuLi9tb2RlbC9teWZlZWQubW9kZWwnO1xuaW1wb3J0IHsgTXlGZWVkU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL215ZmVlZC5zZXJ2aWNlJztcbmltcG9ydCB7IENvbW1vblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zaGFyZWQvdXRpbHMvY29tbW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29uZmlnU2VydmljZSB9IGZyb20gJy4uLy4uL3NoYXJlZC91dGlscy9jb25maWcuc2VydmljZSc7XG5cbmltcG9ydCB7IFZhbHVlTGlzdCB9IGZyb20gXCJuYXRpdmVzY3JpcHQtZHJvcC1kb3duXCI7XG5pbXBvcnQgeyBEcm9wRG93biB9IGZyb20gXCJuYXRpdmVzY3JpcHQtZHJvcC1kb3duL2Ryb3AtZG93blwiO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gXCJ1aS9wYWdlXCI7XG5pbXBvcnQgeyBTZWxlY3RlZEluZGV4Q2hhbmdlZEV2ZW50RGF0YSB9IGZyb20gXCJuYXRpdmVzY3JpcHQtZHJvcC1kb3duXCI7XG5pbXBvcnQgeyBEcm9wRG93blZhbHVlUGFpciB9IGZyb20gJy4uLy4uL3NoYXJlZC9pbnRlcmZhY2VzJztcbmltcG9ydCB7IERhdGVQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbnJlcXVpcmUoIFwibmF0aXZlc2NyaXB0LWxvY2Fsc3RvcmFnZVwiICk7XG5pbXBvcnQgeyBHbG9iYWxTdG9yYWdlU2VydmljZX0gZnJvbSAnLi4vLi4vc2hhcmVkL3N0b3JlL2dsb2JhbHN0b3JhZ2Uuc2VydmljZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlQXJyYXkgfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy9kYXRhL29ic2VydmFibGUtYXJyYXlcIjtcbmltcG9ydCB7IFRleHRGaWVsZCB9IGZyb20gXCJ1aS90ZXh0LWZpZWxkXCI7XG5pbXBvcnQgeyBpc0lPU30gZnJvbSBcInBsYXRmb3JtXCI7XG5pbXBvcnQgKiBhcyBhcHAgZnJvbSBcImFwcGxpY2F0aW9uXCI7XG5pbXBvcnQge1JhZExpc3RWaWV3LExpc3RWaWV3TGluZWFyTGF5b3V0LCBMaXN0Vmlld0V2ZW50RGF0YSwgTGlzdFZpZXdMb2FkT25EZW1hbmRNb2RlfSBmcm9tIFwibmF0aXZlc2NyaXB0LXByby11aS9saXN0dmlld1wiO1xuaW1wb3J0ICogYXMgVGltZXIgZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdGltZXJcIjtcbnZhciBMb2FkaW5nSW5kaWNhdG9yID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1sb2FkaW5nLWluZGljYXRvclwiKS5Mb2FkaW5nSW5kaWNhdG9yO1xuaW1wb3J0IHsgRGF0YVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zaGFyZWQvc2VydmljZXMvZGF0YS5zZXJ2aWNlJztcblxuXG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6ICdhcHAtbXlmZWVkZmlsdGVycmVzdWx0JyxcbiAgICB0ZW1wbGF0ZVVybDogJ215ZmVlZGZpbHRlcnJlc3VsdC5odG1sJyxcbiAgICAvL3N0eWxlVXJsczogWycuL215ZmVlZHNlYXJjaC5jb21wb25lbnQuY3NzJ11cbn0pXG5cblxuZXhwb3J0IGNsYXNzIE15RmVlZEZpbHRlclJlc3VsdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBidXN5OiBTdWJzY3JpcHRpb247XG4gICAgaXNMb2FkaW5nOiBCb29sZWFuID0gZmFsc2U7XG5cbiAgICBzZWFyY2hLZXl3b3JkOnN0cmluZztcbiAgICBuZXdzRmVlZExpc3Q6IE9ic2VydmFibGVBcnJheTxGZWVkSW5mb3JtYXRpb24+O1xuICAgIGZlZWRGaWx0ZXJJbmZvOiBGZWVkRmlsdGVyID0gbmV3IEZlZWRGaWx0ZXIoKTtcbiAgICBwYXJhOkZlZWRGaWx0ZXIgPSBuZXcgRmVlZEZpbHRlcigpO1xuXG4gICAgcmFkTGlzdFZpZXc6UmFkTGlzdFZpZXc7XG4gICAgc3RhdGljIG15RmVlZEZpbHRlclJlc3VsdENvbXBvbmVudDpNeUZlZWRGaWx0ZXJSZXN1bHRDb21wb25lbnQ7XG4gICAgXG5cbiAgICAvL0BWaWV3Q2hpbGQoXCJwYWdlXCIpIHBhZ2VSZWY6IEVsZW1lbnRSZWY7XG4gICAgQFZpZXdDaGlsZChcInJhZExpc3RWaWV3XCIpIHJhZExpc3RWaWV3UmVmOiBFbGVtZW50UmVmO1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcm91dGVyOiBSb3V0ZXIscHJpdmF0ZSByb3V0ZTogQWN0aXZhdGVkUm91dGUscHJpdmF0ZSBkYXRhU2VydmljZTpEYXRhU2VydmljZSxwcml2YXRlIHJvdXRlckV4dGVuc2lvbnM6IFJvdXRlckV4dGVuc2lvbnMscHJpdmF0ZSBmZWVkU2VydmljZTpNeUZlZWRTZXJ2aWNlLCBwcml2YXRlIGdsb2JhbFN0b3JhZ2VTZXJ2aWNlOkdsb2JhbFN0b3JhZ2VTZXJ2aWNlKXsgXG4gICAgICAgIHRoaXMubmV3c0ZlZWRMaXN0ID0gbmV3ICBPYnNlcnZhYmxlQXJyYXk8RmVlZEluZm9ybWF0aW9uPigpO1xuICAgICAgICBNeUZlZWRGaWx0ZXJSZXN1bHRDb21wb25lbnQubXlGZWVkRmlsdGVyUmVzdWx0Q29tcG9uZW50ID0gdGhpcztcblxuICAgICAgICB0aGlzLnJvdXRlLnF1ZXJ5UGFyYW1zLnN1YnNjcmliZShwYXJhbXMgPT4ge1xuICAgICAgICBcbiAgICAgICAgICAgIHRoaXMucGFyYSA9IEpTT04ucGFyc2UocGFyYW1zW1wiRmVlZEZpbHRlckluZm9cIl0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJGZWVkX0lkIFwiICsgdGhpcy5wYXJhLlNlYXJjaEtleXdvcmQpO1xuICAgICAgICAgICBcbiAgICAgICAgfSk7ICBcbiBcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpe1xuICAgICAgICB0aGlzLmluaXRpYWxpemUoKTtcbiAgICAgICAgdGhpcy5sb2FkRmVlZExpc3QoKTtcbiAgICB9XG5cblxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgdGhpcy5yYWRMaXN0VmlldyA9IDxSYWRMaXN0Vmlldz50aGlzLnJhZExpc3RWaWV3UmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgXG4gICAgfVxuXG4gICAgb25OYXZCdG5UYXAoKXtcbiAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLmJhY2tUb1ByZXZpb3VzUGFnZSgpO1xuICAgIH1cbiAgXG5cbiAgICBpbml0aWFsaXplKCkge1xuICAgICAgICBpZih0aGlzLnBhcmEuRmVlZF9DYXRlZ29yeV9JZCA9PSBcIlwiKXtcbiAgICAgICAgICAgIHRoaXMuZmVlZEZpbHRlckluZm8uRmVlZF9DYXRlZ29yeV9JZCA9IG51bGwgO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHRoaXMuZmVlZEZpbHRlckluZm8uRmVlZF9DYXRlZ29yeV9JZCA9IHRoaXMucGFyYS5GZWVkX0NhdGVnb3J5X0lkIDtcbiAgICAgICAgfVxuICAgICAgICBpZih0aGlzLnBhcmEuRmVlZFR5cGVfSWQgPT0gXCJcIil7XG4gICAgICAgICAgICB0aGlzLmZlZWRGaWx0ZXJJbmZvLkZlZWRUeXBlX0lkID0gbnVsbCA7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5GZWVkVHlwZV9JZCA9IHRoaXMucGFyYS5GZWVkVHlwZV9JZCA7XG4gICAgICAgIH1cbiAgICAgICBcbiAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5UaXRsZSA9IG51bGw7XG4gICAgICAgIHRoaXMuZmVlZEZpbHRlckluZm8uU2VhcmNoS2V5d29yZCA9IHRoaXMucGFyYS5TZWFyY2hLZXl3b3JkO1xuICAgICAgICB0aGlzLmZlZWRGaWx0ZXJJbmZvLlBvc3RlZF9EYXRlX0Zyb20gPSB0aGlzLnBhcmEuUG9zdGVkX0RhdGVfRnJvbTtcbiAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5Qb3N0ZWRfRGF0ZV9UbyA9dGhpcy5wYXJhLlBvc3RlZF9EYXRlX1RvO1xuICAgICAgICB0aGlzLmZlZWRGaWx0ZXJJbmZvLkNyZWF0ZWRfRnJvbSA9IHRoaXMucGFyYS5DcmVhdGVkX0Zyb207XG4gICAgICAgIHRoaXMuZmVlZEZpbHRlckluZm8uQ3JlYXRlZF9UbyA9IHRoaXMucGFyYS5DcmVhdGVkX1RvO1xuICAgICAgICB0aGlzLmZlZWRGaWx0ZXJJbmZvLkN1cnNvcl9JbmRleCA9IG51bGw7XG4gICAgICAgIHRoaXMuZmVlZEZpbHRlckluZm8uR2V0X05leHQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5QYWdlX1NpemUgPSAxMDtcbiAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5Qb3N0X1N0YXR1cyA9IHRoaXMucGFyYS5Qb3N0X1N0YXR1cztcbiAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5VblBvc3RfU3RhdHVzID0gdGhpcy5wYXJhLlVuUG9zdF9TdGF0dXM7XG4gICAgICAgIHRoaXMuZmVlZEZpbHRlckluZm8uaXNCbG9ja2VkID0gdGhpcy5wYXJhLmlzQmxvY2tlZDtcbiAgICB9XG5cbiAgICBsb2FkRmVlZExpc3QoKSB7XG4gICAgICAgIHRoaXMuYnVzeSA9IHRoaXMuZmVlZFNlcnZpY2UuZ2V0TmV3c2ZlZWRsaXN0KHRoaXMuZmVlZEZpbHRlckluZm8uRmVlZF9DYXRlZ29yeV9JZCwgXG4gICAgICAgICAgICB0aGlzLmZlZWRGaWx0ZXJJbmZvLkZlZWRUeXBlX0lkLFxuICAgICAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5UaXRsZSwgXG4gICAgICAgICAgICB0aGlzLmZlZWRGaWx0ZXJJbmZvLlNlYXJjaEtleXdvcmQsIFxuICAgICAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5Qb3N0ZWRfRGF0ZV9Gcm9tLCBcbiAgICAgICAgICAgIHRoaXMuZmVlZEZpbHRlckluZm8uUG9zdGVkX0RhdGVfVG8sIFxuICAgICAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5DcmVhdGVkX0Zyb20sIFxuICAgICAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5DcmVhdGVkX1RvLCBcbiAgICAgICAgICAgIHRoaXMuZmVlZEZpbHRlckluZm8uQ3Vyc29yX0luZGV4LCBcbiAgICAgICAgICAgIHRoaXMuZmVlZEZpbHRlckluZm8uR2V0X05leHQsIFxuICAgICAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5QYWdlX1NpemUsIFxuICAgICAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5Qb3N0X1N0YXR1cywgXG4gICAgICAgICAgICB0aGlzLmZlZWRGaWx0ZXJJbmZvLlVuUG9zdF9TdGF0dXMsIFxuICAgICAgICAgICAgdGhpcy5mZWVkRmlsdGVySW5mby5pc0Jsb2NrZWQpXG5cbiAgICAgICAgICAgXG4gICAgICAgICAgICAuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIGZlZWRMaXN0ID0gQXJyYXk8RmVlZEluZm9ybWF0aW9uPigpOyAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmVzLnJlc3VsdC5mb3JFYWNoKGZlZWQgPT4ge1xuICAgICAgICAgICAgICAgICAgIGZlZWRMaXN0LnB1c2goPEZlZWRJbmZvcm1hdGlvbj5mZWVkKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHRoaXMubmV3c0ZlZWRMaXN0LnB1c2goZmVlZExpc3QpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibG9hZEZlZWRMaXN0IC0tPiBcIiArIEpTT04uc3RyaW5naWZ5KHJlcykpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIG9uTG9hZE1vcmVJdGVtc1JlcXVlc3RlZChhcmdzOiBMaXN0Vmlld0V2ZW50RGF0YSkge1xuICAgICAgICB2YXIgdGhhdCA9IG5ldyBXZWFrUmVmKHRoaXMpO1xuICAgICAgICB2YXIgbGlzdFZpZXc6IFJhZExpc3RWaWV3ID0gYXJncy5vYmplY3Q7XG4gICAgICAgIGxldCBhcnJMZW5ndGggPSB0aGF0LmdldCgpLm5ld3NGZWVkTGlzdC5sZW5ndGg7XG5cbiAgICAgICAgVGltZXIuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGF0LmdldCgpLmxvYWRNb3JlRmVlZHMoKTtcbiAgICAgICAgICAgIGxpc3RWaWV3Lm5vdGlmeUxvYWRPbkRlbWFuZEZpbmlzaGVkKCk7XG4gICAgICAgICAgIFxuICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgLy99XG4gICAgICAgIGFyZ3MucmV0dXJuVmFsdWUgPSB0cnVlO1xuICAgIH1cblxuXG4gICAgb25JdGVtVGFwKGFyZ3MpIHtcbiAgICAgICAgbGV0IHNlbGVjdGVkSW5kZXg6bnVtYmVyID0gPG51bWJlcj5hcmdzLmluZGV4O1xuICAgICAgICB2YXIgZmVlZCA9IHRoaXMubmV3c0ZlZWRMaXN0LmdldEl0ZW0oc2VsZWN0ZWRJbmRleCk7XG4gICAgICAgIGxldCBuYXZpZ2F0aW9uRXh0cmFzOiBOYXZpZ2F0aW9uRXh0cmFzID0ge1xuICAgICAgICAgICAgcXVlcnlQYXJhbXM6IHtcbiAgICAgICAgICAgICAgICBcIkNhbGxlckNsYXNzXCIgOiBcIk15RmVlZEZpbHRlclJlc3VsdENvbXBvbmVudFwiLFxuICAgICAgICAgICAgICAgIFwiU2VsZWN0ZWRQb3NpdGlvblwiIDogc2VsZWN0ZWRJbmRleCxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW1wiL215ZmVlZC9cIisgZmVlZC5GZWVkX0lkKyBcIi92aWV3XCJdLG5hdmlnYXRpb25FeHRyYXMpIC8vcm91dGUgdG8gZmVlZF9kZXRhaWwoMSlcbiAgICAgICAgXG4gICAgICAgIFxuICAgIH1cblxuICAgIGxvYWRNb3JlRmVlZHMoKSB7XG4gICAgICAgIGlmICh0aGlzLm5ld3NGZWVkTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmZlZWRGaWx0ZXJJbmZvLkN1cnNvcl9JbmRleCA9IHRoaXMubmV3c0ZlZWRMaXN0LmdldEl0ZW0odGhpcy5uZXdzRmVlZExpc3QubGVuZ3RoIC0gMSkuRmVlZF9JZDtcbiAgICAgICAgICAgIHRoaXMuZmVlZEZpbHRlckluZm8uR2V0X05leHQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvYWRGZWVkTGlzdCgpO1xuICAgIH1cblxuICAgIGdldElubmVySHRtbChkZXNjOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IGRvdCA9ICcnOyAgICAgICAgXG4gICAgICAgIHZhciBydG4gPSBkZXNjLnJlcGxhY2UoLzxcXC8/W14+XSs+L2lnLCBcIiBcIik7XG4gICAgICAgIHJ0biA9IHJ0bi5yZXBsYWNlKFwiXFxuXCIsXCJcIik7XG4gICAgICAgIHJ0biA9IHJ0bi5yZXBsYWNlKFwiJm5ic3A7XCIsXCJcIik7XG4gICAgICAgIFxuICAgICAgICBpZiAocnRuLmxlbmd0aCA+IDEwMCkgeyBkb3QgPSAnLi4uLi4nOyB9XG4gICAgICAgICAgICBcbiAgICAgICAgcnRuID0gcnRuLnN1YnN0cmluZygwLCAxMDApO1xuICAgICAgICBpZiAocnRuLmxlbmd0aCA+MCkgeyByZXR1cm4gcnRuICsgZG90OyB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdXBkYXRlTXlGZWVkc1VJKGZlZWQ6IEZlZWRJbmZvcm1hdGlvbixpc0ZlZWRVcGRhdGVPckNyZWF0ZTpzdHJpbmcscG9zaXRpb246bnVtYmVyKXtcbiAgICAgICAgY29uc29sZS5sb2coXCJmZWVkIFwiICsgSlNPTi5zdHJpbmdpZnkoZmVlZCkpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInVwZGF0ZSBteSBmZWVkTGlzdCBcIiArIGlzRmVlZFVwZGF0ZU9yQ3JlYXRlICsgXCIgcG9zaXRpb24gXCIgKyBwb3NpdGlvbik7XG4gICAgICAgIGlmKGlzRmVlZFVwZGF0ZU9yQ3JlYXRlID09IFwibmV3XCIpe1xuICAgICAgICAgICAgdGhpcy5uZXdzRmVlZExpc3QudW5zaGlmdChmZWVkKTtcbiAgICAgICAgICAgIHRoaXMucmFkTGlzdFZpZXcucmVmcmVzaCgpO1xuICAgICAgICAgICAgLy9hbGVydChcIkZlZWQgc3VjY2Vzc2Z1bGx5IGNyZWF0ZWQhXCIpO1xuICAgICAgICB9ZWxzZSBpZihpc0ZlZWRVcGRhdGVPckNyZWF0ZSA9PSBcInVwZGF0ZVwiKXtcbiAgICAgICAgICAgIC8vdGhpcy5uZXdzRmVlZExpc3Quc3BsaWNlKHBvc2l0aW9uLCAxKTsvLyAxLCAxXG4gICAgICAgICAgICAvL3RoaXMubmV3c0ZlZWRMaXN0LnNwbGljZShwb3NpdGlvbiwwLGZlZWQpOy8vMSxmZWVkXG4gICAgICAgICAgICAvL3RoaXMubmV3c0ZlZWRMaXN0Lm5vdGlmeTtcblxuICAgICAgICAgICAgdGhpcy5uZXdzRmVlZExpc3QuZ2V0SXRlbShwb3NpdGlvbikuRmVlZF9DYXRlZ29yeV9JZCA9IGZlZWQuRmVlZF9DYXRlZ29yeV9JZDtcbiAgICAgICAgICAgIHRoaXMubmV3c0ZlZWRMaXN0LmdldEl0ZW0ocG9zaXRpb24pLkZlZWRfQ2F0ZWdvcnlfTmFtZSA9IGZlZWQuRmVlZF9DYXRlZ29yeV9OYW1lO1xuICAgICAgICAgICAgdGhpcy5uZXdzRmVlZExpc3QuZ2V0SXRlbShwb3NpdGlvbikuRmVlZFR5cGVfSWQgPSBmZWVkLkZlZWRUeXBlX0lkO1xuICAgICAgICAgICAgdGhpcy5uZXdzRmVlZExpc3QuZ2V0SXRlbShwb3NpdGlvbikuRmVlZF9UeXBlX05hbWUgPSBmZWVkLkZlZWRfVHlwZV9OYW1lO1xuICAgICAgICAgICAgdGhpcy5uZXdzRmVlZExpc3QuZ2V0SXRlbShwb3NpdGlvbikuVGl0bGUgPSBmZWVkLlRpdGxlO1xuICAgICAgICAgICAgdGhpcy5uZXdzRmVlZExpc3QuZ2V0SXRlbShwb3NpdGlvbikuRGVzY3JpcHRpb24gPSBmZWVkLkRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgdGhpcy5uZXdzRmVlZExpc3QuZ2V0SXRlbShwb3NpdGlvbikuUG9zdGVkX0RhdGUgPSBmZWVkLlBvc3RlZF9EYXRlO1xuICAgICAgICAgICAgdGhpcy5uZXdzRmVlZExpc3QuZ2V0SXRlbShwb3NpdGlvbikuUG9zdF9TdGF0dXMgPSBmZWVkLlBvc3RfU3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5uZXdzRmVlZExpc3QuZ2V0SXRlbShwb3NpdGlvbikuTGFzdF9VcGRhdGVkX0J5ID0gZmVlZC5MYXN0X1VwZGF0ZWRfQnk7XG4gICAgICAgICAgICB0aGlzLm5ld3NGZWVkTGlzdC5nZXRJdGVtKHBvc2l0aW9uKS5MYXN0X1VwZGF0ZWRfT24gPSBmZWVkLkxhc3RfVXBkYXRlZF9PbjtcbiAgICAgICAgICAgIHRoaXMubmV3c0ZlZWRMaXN0LmdldEl0ZW0ocG9zaXRpb24pLnN0YXR1cyA9IGZlZWQuc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5uZXdzRmVlZExpc3QuZ2V0SXRlbShwb3NpdGlvbikuTUNfRmVlZF9GaWxlcyA9IGZlZWQuTUNfRmVlZF9GaWxlcztcblxuICAgICAgICAgICAgLy9hbGVydChcIkZlZWQgc3VjY2Vzc2Z1bGx5IHVwZGF0ZWQhXCIpO1xuXG4gICAgICAgIH1lbHNlIGlmKCBpc0ZlZWRVcGRhdGVPckNyZWF0ZSA9PSBcIkFSQ0hJVkVcIil7XG4gICAgICAgICAgICB0cnl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ1bnBvc3QgbXlGZWVkc1wiKTsgXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBpID0gdGhpcy5uZXdzRmVlZExpc3QuaW5kZXhPZih0aGlzLm5ld3NGZWVkTGlzdC5nZXRJdGVtKHBvc2l0aW9uKSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXdzRmVlZExpc3Quc3BsaWNlKGksMSk7XG4gICAgICAgICAgICAgICAgICAgIC8vYWxlcnQoXCJGZWVkIHN1Y2Nlc3NmdWxseSB1bnBvc3RlZCFcIik7ICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVtb3ZlIFwiICsgcG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIH0sIDIwMDApO1xuXG4gICAgICAgICAgICB9Y2F0Y2goZSl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgICAgICB9XG4gIFxuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZihpc0ZlZWRVcGRhdGVPckNyZWF0ZSA9PSBcIk5PVElGWVwiKXtcbiAgICAgICAgICAgIGFsZXJ0KFwiRmVlZHMgc3VjY2Vzc2Z1bGx5IG5vdGlmaWVkIVwiKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXRNeUZlZWRzRmlsdGVyUmVzdWx0T2JqZWN0KCl7XG4gICAgICAgIHJldHVybiBNeUZlZWRGaWx0ZXJSZXN1bHRDb21wb25lbnQubXlGZWVkRmlsdGVyUmVzdWx0Q29tcG9uZW50O1xuICAgIH1cbn1cblxuXG4iXX0=